# Building a Safari App Extension

[article](https://developer.apple.com/documentation/safariservices/safari_app_extensions/building_a_safari_app_extension)

## Overview

Вы доставляете расширение приложения Safari внутри приложения macOS. Когда пользователь запускает ваше приложение в первый раз, расширение приложения сразу становится доступным в Safari. В этой статье описаны следующие шаги по созданию собственного расширения приложения Safari:

* Добавление цели расширения приложения Safari в ваше приложение в Xcode.
* Добавление файлов скриптов и таблиц стилей для внедрения в ваше приложение и изменения содержимого веб-страницы.
* Настройка значений списка свойств в вашем приложении, связанных с расширением приложения Safari.
* Создание и запуск вашего приложения, которое создает ваше расширение приложения Safari для использования.
* Включение расширения приложения Safari в Safari, чтобы вы могли его использовать.


## Add a Safari App Extension Target in Xcode

Чтобы создать расширение приложения Safari, добавьте новую цель в существующий проект приложения macOS в Xcode:

1. Запустите Xcode и либо откройте существующий проект, содержащий приложение macOS, либо создайте новый.
1. Выберите «Файл»> «Создать»> «Цель».
1. В списке шаблонов в разделе «Расширение приложения» выберите «Расширение Safari» и нажмите «Далее».
1. Введите название продукта для вашего расширения, например «Мое расширение».
1. Убедитесь, что проект вашего приложения выбран в меню «Проект», а цель приложения macOS выбрана в меню «Вставить в приложение».
1. Щелкните Готово.
1. Когда Xcode спросит вас, хотите ли вы активировать новую схему для вашего нового расширения, нажмите Отмена.
1. Xcode добавляет новую группу в ваш проект, которая содержит несколько новых файлов, включая файл Info.plist, различные вспомогательные исходные файлы, файл Interface Builder, файл JavaScript и изображение панели инструментов PDF.

## Appicon

[stackoverflow](https://stackoverflow.com/questions/28170520/ios-how-to-set-app-icon-and-launch-images)

На изображении в самом верху указаны размеры пикселей для каждого размера точки, который требуется в iOS 9. Однако, даже если я не обновлю этот ответ для будущих версий iOS, вы все равно можете определить правильные размеры пикселей, используя метод ниже.

Посмотрите, сколько точек (pt) занимает каждый пробел в пустом наборе изображений. Если изображение 1x, то пиксели совпадают с точками. Для 2x удвоить очки и 3x утроить очки. Так, например, в первом пустом поле выше (29pt 2x) вам понадобится изображение размером 58x58 пикселей.

Вы можете начать с изображения 1024x1024 пикселей, а затем уменьшить его до нужных размеров. Вы можете сделать это сами или есть сайты и скрипты для получения нужных размеров. Выполните поиск по запросу «генератор значков приложений для ios» или что-то подобное.

Я не думаю, что имена имеют значение, если вы правильно определяете размеры, но общее соглашение об именах следующее:


## Add Scripts and Style Sheets

После добавления скриптов и таблиц стилей в расширение приложения Safari вы сможете читать и изменять содержимое веб-страницы, а также читать и отправлять данные из своего приложения. Дополнительные сведения о внедрении скриптов и таблиц стилей в содержимое веб-страницы см. В разделе «О внедренных таблицах стилей и скриптах».


## Add Keys to the Info Property List Template

Файл Info.plist по умолчанию идентифицирует ваше новое расширение приложения Safari и определяет его возможности и ограничения доступа под ключом NSExtension. Дополнительные сведения об установке этих возможностей и ограничений см. В разделе Ключи списка свойств информации о расширении приложения Safari. В файле списка свойств информации вы также можете указать настраиваемые параметры пользовательского интерфейса, такие как элементы контекстного меню и элементы панели инструментов. Дополнительные сведения об этих настройках см. В разделе «О клавишах контекстного меню и элементов панели инструментов».


## Build and Run the Application

Прежде чем Safari сможет найти ваше новое расширение, вы должны запустить родительское приложение хотя бы один раз:
Убедитесь, что ваше приложение macOS выбрано в меню «Схема» рядом с кнопками «Выполнить» и «Стоп» на главной панели инструментов Xcode.
Нажмите кнопку «Выполнить» или выберите «Продукт»> «Выполнить» (Command-R), чтобы создать и запустить приложение.
Когда вы создаете свое приложение, Xcode сначала создает расширение приложения Safari, а затем встраивает его в готовый пакет приложения. Как только ваше приложение запустится, ваше расширение будет готово к использованию в Safari.


## Enable Your App Extension in Safari

Если вы не участвуете в программе разработки Apple или еще не настроили удостоверение разработчика для существующего проекта Xcode, ваше расширение приложения Safari не будет подписано сертификатом разработки. В целях безопасности Safari по умолчанию игнорирует неподписанные расширения, поэтому ваше расширение не будет отображаться в настройках расширений Safari.
Для разработки без сертификата при каждом запуске Safari вы должны указать ему загружать неподписанные расширения с помощью меню «Разработка»:

* Откройте Safari и выберите Safari> Настройки.
* Выберите вкладку «Дополнительно», затем установите флажок «Показать меню разработки в строке меню».
* Выберите «Разработка»> «Разрешить беззнаковые расширения». Параметр «Разрешить неподписанные расширения» сбрасывается, когда пользователь закрывает Safari; вы должны установить его снова при следующем запуске Safari.
* Выберите вкладку Расширения. На этой вкладке отображается локализованное описание, отображаемое имя и номер версии для выбранного расширения приложения Safari. Он также предоставляет более подробное сообщение о разрешениях, заявленных расширением.
* Найдите новое расширение в списке слева и включите его, установив флажок.
* Закройте настройки Safari.
* Ваше новое расширение теперь включено. Если вы создали расширение шаблона по умолчанию, не изменяя его, вы увидите новый элемент панели инструментов (кнопку) на панели инструментов Safari. Когда вы нажимаете эту кнопку, расширение приложения Safari регистрирует сообщение, которое вы можете просмотреть в системной консоли - это сообщение поступает от вашего подкласса SFSafariExtensionHandler.
* Если у вас возникли проблемы с работой расширения, см. Раздел Устранение неполадок расширения приложения Safari.




# About Injected Style Sheets and Scripts

[article](https://developer.apple.com/documentation/safariservices/safari_app_extensions/about_injected_style_sheets_and_scripts) 

Узнайте, как вы можете повлиять на внешний вид или поведение веб-страницы с помощью внедренных таблиц стилей и скриптов.

## Overview

Чтобы добавить или переопределить стили и поведение на веб-странице, вы пишете таблицы стилей и сценарии, которые затем вставляете на свою веб-страницу для чтения и изменения ее содержимого.

## Injected Style Sheets

Внедренные таблицы стилей рассматриваются как пользовательские таблицы стилей в соответствии с определением W3C. Стили добавляются в следующем порядке:

* Ваши стили расширения приложения Safari
* Стили автора веб-страницы
* Стили автора веб-страницы, объявленные как! Important
* Ваши стили расширения приложения Safari, которые объявлены как! Important

На каждом этапе новое определение отменяет любое предыдущее. Свойства стиля во внедренных таблицах стилей добавляются к существующим свойствам стилей страницы, но ваши стили не отменяют существующие стили страниц, если вы не объявите новые как! Important.
Например, добавление следующих стилей переопределяет веб-сайт, использующий цветной текст на цветном фоне, и устанавливает для него черный текст на белом фоне для определенного элемента:
	
	span.anElement {
	    color:black;
	    background:white;
	}
	
	
	
# Injecting CSS Style Sheets into a Webpage

[article](https://developer.apple.com/documentation/safariservices/safari_app_extensions/injecting_css_style_sheets_into_a_webpage)

Добавляйте или переопределяйте стили, вставляя таблицы стилей CSS в веб-страницы.
Фреймворк

После того, как вы написали таблицу стилей, которая может изменять представление страницы, вам необходимо добавить ее в расширение приложения Safari и применить к веб-страницам.
Таблица стилей может применяться к одной веб-странице, всем веб-страницам или только некоторым веб-страницам, например, веб-страницам из определенных доменов. Чтобы ваша таблица стилей была внедрена, вы должны указать для расширения вашего приложения доступ к веб-сайту Some или All. Подробнее см. Доступ и разрешения. Дополнительные сведения о внедренных таблицах стилей см. В разделе «О внедренных таблицах стилей и скриптах».

## Добавить таблицу стилей

[article](https://ulriklyngs.com/post/2018/11/02/how-to-build-safari-app-extensions/#step-5-injecting-a-style-sheet-1)

	/Users/alex/Library/Developer/Xcode/DerivedData/yandexapp-gkrgsdqychyvbsfmkiboqlhwzham/Build/Products

После указания доступа к веб-сайту добавьте таблицу стилей в расширение приложения Safari.

* Добавьте файлы CSS в целевой Xcode вашего расширения.
* Добавьте ключ SFSafariStyleSheet к элементу NSExtension в файле Info.plist вашего расширения. Значение этого ключа - массив словарей.

Для каждого файла CSS добавьте словарь в этот массив. Каждый словарь должен иметь ключ таблицы стилей, значение которого указывает путь (относительно каталога ресурсов пакета) к таблице стилей для включения.

> По умолчанию всегда вводится таблица стилей при условии, что у расширения есть разрешение на доступ к веб-странице. Однако вы можете указать дополнительные ключи словаря, чтобы обеспечить более точный контроль над тем, вставляется ли эта таблица стилей на веб-страницу. Для получения дополнительной информации см. Доступ и разрешения.

У вас может быть несколько внедренных таблиц стилей. Таблицы стилей обрабатываются в том порядке, в котором они указаны.
Ваша таблица стилей может ссылаться на ресурсы в комплекте расширения приложения. Все относительные URL-адреса относятся к папке "Ресурсы" в пакете расширения приложения.